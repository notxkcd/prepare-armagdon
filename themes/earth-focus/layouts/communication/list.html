{{ define "main" }}
<article class="spiritual-dashboard">
    <header class="stats-header" style="text-align: center; margin-bottom: 4rem;">
        <span class="sacred-label">Spiritual Foundation</span>
        <h1 style="margin-top: 1rem;">Communication with God</h1>
        <p class="meta">Adherence to the protocol and records of dialogue.</p>
    </header>

    {{/* 1. Aggregate Faith Data */}}
    {{ $dailyLogs := where .Site.RegularPages "Section" "daily" }}
    {{ $totalSalah := 0 }}
    {{ $totalBaqarah := 0 }}
    {{ $totalTahajjud := 0 }}
    {{ $daysTracked := len $dailyLogs }}

    {{/* Per-prayer counters */}}
    {{ $fajrCount := 0 }}{{ $dhuhrCount := 0 }}{{ $asrCount := 0 }}{{ $maghribCount := 0 }}{{ $ishaCount := 0 }}

    {{ range $dailyLogs }}
        {{ $c := .RawContent }}
        {{/* Count Salah and Specifics */}}
        {{ if and (in $c "[x]") (in $c "Fajr") }} {{ $totalSalah = add $totalSalah 1 }}{{ $fajrCount = add $fajrCount 1 }} {{ end }}
        {{ if and (in $c "[x]") (in $c "Dhuhr") }} {{ $totalSalah = add $totalSalah 1 }}{{ $dhuhrCount = add $dhuhrCount 1 }} {{ end }}
        {{ if and (in $c "[x]") (in $c "Asr") }} {{ $totalSalah = add $totalSalah 1 }}{{ $asrCount = add $asrCount 1 }} {{ end }}
        {{ if and (in $c "[x]") (in $c "Maghrib") }} {{ $totalSalah = add $totalSalah 1 }}{{ $maghribCount = add $maghribCount 1 }} {{ end }}
        {{ if and (in $c "[x]") (in $c "Isha") }} {{ $totalSalah = add $totalSalah 1 }}{{ $ishaCount = add $ishaCount 1 }} {{ end }}
        
        {{/* Count Recurring */}}
        {{ if and (in $c "[x]") (in $c "Surah Al-Baqarah") }} {{ $totalBaqarah = add $totalBaqarah 1 }} {{ end }}
        {{ if and (in $c "[x]") (in $c "Salatul Tahajjud") }} {{ $totalTahajjud = add $totalTahajjud 1 }} {{ end }}
    {{ end }}

    {{/* 2. Spiritual Stat Cards */}}
    <section class="dashboard-grid">
        <div class="stat-card sacred-card">
            <span class="stat-label">Total Salah</span>
            <span class="stat-value">{{ $totalSalah }}</span>
            <span class="stat-sub">Across {{ $daysTracked }} days</span>
        </div>
        <div class="stat-card sacred-card">
            <span class="stat-label">Al-Baqarah</span>
            <span class="stat-value">{{ $totalBaqarah }}</span>
            <span class="stat-sub">Completions</span>
        </div>
        <div class="stat-card sacred-card">
            <span class="stat-label">Tahajjud</span>
            <span class="stat-value">{{ $totalTahajjud }}</span>
            <span class="stat-sub">Vigils</span>
        </div>
    </section>

    {{/* 3. Cumulative Prayer Breakdown */}}
    <section style="margin-top: 4rem;">
        <h2 style="text-align: center;">Prayer Breakdown</h2>
        <div class="prayer-breakdown-grid">
            <div class="prayer-stat"><span>Fajr</span> <strong>{{ $fajrCount }}</strong></div>
            <div class="prayer-stat"><span>Dhuhr</span> <strong>{{ $dhuhrCount }}</strong></div>
            <div class="prayer-stat"><span>Asr</span> <strong>{{ $asrCount }}</strong></div>
            <div class="prayer-stat"><span>Maghrib</span> <strong>{{ $maghribCount }}</strong></div>
            <div class="prayer-stat"><span>Isha</span> <strong>{{ $ishaCount }}</strong></div>
        </div>
    </section>

    {{/* 4. Weekly Salah Adherence (No-Brainer Grid) */}}
    <section style="margin-top: 5rem;">
        <h2 style="text-align: center;">Weekly Adherence</h2>
        <p style="text-align: center; font-size: 0.9rem; color: #777; margin-bottom: 2rem;">Last 7 days of prayers</p>
        
        <div class="salah-tracker-grid">
            <div class="tracker-header"></div>
            <div class="tracker-header">F</div>
            <div class="tracker-header">D</div>
            <div class="tracker-header">A</div>
            <div class="tracker-header">M</div>
            <div class="tracker-header">I</div>

            {{ range (first 7 $dailyLogs).Reverse }}
                {{ $c := .RawContent }}
                <div class="tracker-label">{{ .Date.Format "Mon" }}</div>
                <div class="tracker-dot {{ if and (in $c "[x]") (in $c "Fajr") }}done{{ end }}" title="Fajr"></div>
                <div class="tracker-dot {{ if and (in $c "[x]") (in $c "Dhuhr") }}done{{ end }}" title="Dhuhr"></div>
                <div class="tracker-dot {{ if and (in $c "[x]") (in $c "Asr") }}done{{ end }}" title="Asr"></div>
                <div class="tracker-dot {{ if and (in $c "[x]") (in $c "Maghrib") }}done{{ end }}" title="Maghrib"></div>
                <div class="tracker-dot {{ if and (in $c "[x]") (in $c "Isha") }}done{{ end }}" title="Isha"></div>
            {{ end }}
        </div>
    </section>

    <hr style="margin: 5rem 0;">

    {{/* 5. Dialogue List */}}
    <section class="dialogue-archive">
        <h2>Dialogue Records</h2>
        <div class="list">
            {{ range .Pages.ByDate.Reverse }}
            <div class="list-item summary-card dialogue-card">
                <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
                <span class="meta">{{ .Date.Format "January 2, 2006" }}</span>
                <p>{{ .Summary }}</p>
                <a href="{{ .RelPermalink }}" style="font-family: 'Patrick Hand', cursive; text-decoration: none;">Read Dialogue &rarr;</a>
            </div>
            {{ end }}
        </div>
    </section>
</article>

<style>
.sacred-card {
    border-top: 3px solid var(--accent-color) !important;
}

/* Prayer Breakdown */
.prayer-breakdown-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1rem;
    max-width: 600px;
    margin: 2rem auto;
}

.prayer-stat {
    text-align: center;
    padding: 1rem;
    background: #fcfbf9;
    border: 1px solid var(--border-color);
    border-radius: 6px;
}

.prayer-stat span {
    display: block;
    font-size: 0.75rem;
    text-transform: uppercase;
    color: #999;
}

.prayer-stat strong {
    font-size: 1.5rem;
    color: var(--accent-color);
}

/* Salah Tracker Grid */
.salah-tracker-grid {
    display: grid;
    grid-template-columns: 80px repeat(5, 1fr);
    gap: 10px;
    max-width: 400px;
    margin: 0 auto;
    align-items: center;
}

.tracker-header {
    text-align: center;
    font-size: 0.8rem;
    font-weight: 700;
    color: #999;
}

.tracker-label {
    font-family: 'Patrick Hand', cursive;
    font-size: 1.1rem;
    color: #666;
}

.tracker-dot {
    width: 24px;
    height: 24px;
    background: #ebedf0;
    border-radius: 50%;
    margin: 0 auto;
    border: 1px solid rgba(0,0,0,0.05);
}

.tracker-dot.done {
    background: var(--accent-color);
    box-shadow: 0 0 8px rgba(85, 107, 47, 0.3);
}

.dialogue-card {
    border-left: 2px solid #e6e2da;
    padding-left: 1.5rem !important;
}

.dialogue-card:hover {
    border-left-color: var(--accent-color);
}
</style>
{{ end }}